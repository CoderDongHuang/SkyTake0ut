


1、直接取消订单，跳过支付相关操作
修改 OrderServiceImpl.java 中的 userCancelById 方法
/**
* 用户取消订单
*
* @param id
  */
  public void userCancelById(Long id) throws Exception {
  // 根据id查询订单
  Orders ordersDB = orderMapper.getById(id);

  // 校验订单是否存在
  if (ordersDB == null) {
  throw new OrderBusinessException(MessageConstant.ORDER_NOT_FOUND);
  }

  //订单状态 1待付款 2待接单 3已接单 4派送中 5已完成 6已取消
  if (ordersDB.getStatus() > 2) {
  throw new OrderBusinessException(MessageConstant.ORDER_STATUS_ERROR);
  }

  Orders orders = new Orders();
  orders.setId(ordersDB.getId());

  // 订单处于待接单状态下取消，需要进行退款
  // 注释掉微信支付退款接口调用，因为没有实际支付
  /*if (ordersDB.getStatus().equals(Orders.TO_BE_CONFIRMED)) {
  //调用微信支付退款接口
  weChatPayUtil.refund(
  ordersDB.getNumber(), //商户订单号
  ordersDB.getNumber(), //商户退款单号
  new BigDecimal(0.01),//退款金额，单位 元
  new BigDecimal(0.01));//原订单金额

       //支付状态修改为 退款
       orders.setPayStatus(Orders.REFUND);
  }*/

  // 直接设置为已退款状态（模拟）
  if (ordersDB.getStatus().equals(Orders.TO_BE_CONFIRMED)) {
  orders.setPayStatus(Orders.REFUND);
  }

  // 更新订单状态、取消原因、取消时间
  orders.setStatus(Orders.CANCELLED);
  orders.setCancelReason("用户取消");
  orders.setCancelTime(LocalDateTime.now());
  orderMapper.update(orders);
  }

修改说明
注释掉微信退款接口调用：
移除了对 weChatPayUtil.refund() 的调用，避免因缺少配置导致的错误
保留了支付状态的更新逻辑，将订单标记为已退款状态
保持原有业务逻辑：
继续检查订单是否存在和状态是否允许取消
保留订单状态更新为"已取消"
保留取消原因和取消时间的记录
这样修改后，即使没有配置微信支付相关信息，用户也可以正常取消订单，
系统会跳过实际的退款操作，但仍会在数据库中正确记录订单状态变化。