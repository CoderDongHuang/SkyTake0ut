

跳过微信支付的方法

1、将OrderServiceImpl中的payment方法中的微信支付调用接口注释掉
//调用微信支付接口，生成预支付交易单
JSONObject jsonObject = weChatPayUtil.pay(
    ordersPaymentDTO.getOrderNumber(), //商户订单号 
    new BigDecimal(0.01), //支付金额，单位 元
    "苍穹外卖订单", //商品描述
    user.getOpenid() //微信用户的openid
);
重新new一个空的JSONObject对象
JSONObject jsonObject = new JSONObject();

2、然后OrderController里面直接调用paySuccess方法
log.info("订单支付：{}", ordersPaymentDTO);
OrderPaymentVO orderPaymentVO = orderService.payment(ordersPaymentDTO);
log.info("生成预支付交易单：{}", orderPaymentVO);
orderService.paySuccess(ordersPaymentDTO.getOrderNumber());//<--加这句
return Result.success(orderPaymentVO);

3、在前端小程序的支付逻辑代码中改成下面的代码
位置：pages/pay/index.js 225行
修改代码：
if (res.code === 1) {wx.showModal({
        title: '提示',
        content: '支付成功',
        success:function(){
        uni.redirectTo({url: '/pages/success/index?orderId=' + _this.orderId });
        }
    })
    console.log('支付成功!')
// wx.requestPayment({
//   nonceStr: res.data.nonceStr,
//   package: res.data.packageStr,
//   paySign: res.data.paySign,
//   timeStamp: res.data.timeStamp,
//   signType: res.data.signType,
//   success:function(res){
//     wx.showModal({
//       title: '提示',
//       content: '支付成功',
//       success:function(){
//         uni.redirectTo({url: '/pages/success/index?orderId=' + _this.orderId });
//       }
//     })
//     console.log('支付成功!')
//   }
// })

解释原因：
1、跳过真实的微信支付接口调用，实现本地模拟支付成功的效果
后端把微信支付接口调用注释掉，新建一个空的JSONObject对象，为了后续代码正常运行，同上防止对象为空，抛空指针异常
然后直接调用paySuccess方法，跳过支付流程，模拟支付成功业务
小程序注释requestPayment()支付方法，不会触发真实的支付弹窗
用showModal和redirectTo模拟支付成功的交互，让前端把流程走完，达到支付成功的界面交互和跳转效果
无需依赖微信支付真正的真实环境和配置